#!/bin/bash
# preinst script for pivotal-gemfirexd
#

set -e
case "$1" in
  install|upgrade)
# create group and user account if they do not exist
if [ ! -n "`/usr/bin/getent group pivotal`" ]; then
    /usr/sbin/groupadd pivotal 2> /dev/null
fi
# Create gemfirexd user with home as DataDir
if [ ! -n "`/usr/bin/getent passwd gemfirexd`" ]; then
    /bin/mkdir -p -m 755 /var/lib/pivotal/gemfirexd
    /usr/sbin/useradd -g pivotal -d /var/lib/pivotal/gemfirexd -s /sbin/nologin -c "Pivotal GemFire XD" gemfirexd 2> /dev/null
elif [ `getent passwd gemfirexd | grep -c lib` -gt "0" ]; then
    # An old gemfirexd user account still exists, modify it 
    # cannot use -m here reliably
    usermod -d /var/lib/pivotal/gemfirexd -g pivotal -s /sbin/nologin -c "Pivotal GemFire XD" gemfirexd
else
    # Create DataDir
    /bin/mkdir -p -m 755 /var/lib/pivotal/gemfirexd
    chown -R gemfirexd:pivotal /var/lib/pivotal/gemfirexd
fi
;;

    
    *)
        #echo "postinst called with unknown argument \`$1'" >&2
        #exit 1
    ;;
esac

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

#DEBHELPER#

exit 0
